RGSRC=../../
include $(RGSRC)/envir.mak

MKCONFIG=$(BUILDDIR)/pkg/util/mkconfig
TARGET_FILES=libc_config_int.h net-tools-config.h libc_config.make

CD_EXPORTED_FILES+=align.h bio_socket.h bt_defs.h console_colors.h \
  daemon_init.h ebuf.h enum_macros.h enums.h estream.h estream_utils.h \
  esyscall.h event.h iana_if_type.h inet_conv.h io_wrappers.h ipc.h \
  ip_proto_name.h ipsec_types.h jhash.h libc_config.h libc_config_include.h \
  misc_funcs.h mmu_context.h net_types.h net_utils.h oam_ping.h obscure.h \
  os_includes.h os_libc_extra.h process_funcs.h pvc_scan.h read_conf_file.h \
  rg_conf_entries.h rg_def.h rg_defines.h rg_error_native.h rg_getopt.h \
  rg_ioctl.h rg_iplist.h rg_os.h rg_ppp.h rg_types.h rg_version_data.h \
  rg_version.h set.h set_utils.h stop.h syscalls.h vpn_utils.h vx_in6.h \
  wireless_defs.h os_includes.h rg_os.h rg_types.h net_types.h rg_iplist.h \
  set.h rg_conf_entries.h rg_version.h rg_set_utils.h comp_reg.h \
  external_version_data.h clink.h cc_config.h mii.h igmp_proxy_consts.h \
  be_api_gpl.h kos_chardev_id.h dyn_field.h

CD_EXPORTED_FILES+=libc_config_bigendian.make libc_config_common.make \
  libc_config_dl.make libc_config_glibc.make libc_config_linux.make \
  libc_config_mmu.make libc_config_ulibc.make libc_config_vx.make \
  net-tools-config.make libc_config_arch_ppc.make

RG_CONFIG_MAKE_SRC=libc_config_common.make

ifeq ($(CONFIG_DYN_LINK),y)
  RG_CONFIG_MAKE_SRC+=libc_config_dl.make
endif
ifeq ($(TARGET_ENDIANESS),BIG)
  RG_CONFIG_MAKE_SRC+=libc_config_bigendian.make
endif

ifdef CONFIG_RG_OS_VXWORKS
  RG_CONFIG_MAKE_SRC+=libc_config_vx.make
endif
ifdef CONFIG_RG_OS_LINUX
  RG_CONFIG_MAKE_SRC+=libc_config_linux.make
  ifeq ($(RG_LIB_VERSION),ulibc)
    RG_CONFIG_MAKE_SRC+=libc_config_ulibc.make
    ifeq ($(CONFIG_HAS_MMU),y)
      RG_CONFIG_MAKE_SRC+=libc_config_mmu.make
    endif
  endif
  ifeq ($(RG_LIB_VERSION),glibc)
    RG_CONFIG_MAKE_SRC+=libc_config_glibc.make
  endif
  ifeq ($(ARCH), ppc)
    RG_CONFIG_MAKE_SRC+=libc_config_arch_ppc.make
  endif
endif

ARCHCONFIG_FIRST_TASKS+=$(TARGET_FILES)

libc_config_int.h: libc_config.make $(MKCONFIG)
	@echo "Generating \"$@\""
	@echo "/* This file was autogenerated from libc_config.make. Do not edit */" > $@
	@$(MKCONFIG) $< >> $@

libc_config.make: $(RG_CONFIG_MAKE_SRC)
	@echo "Generating \"$@\""
	@echo "Using LibC defined as \"$(RG_LIB_VERSION)\""
	@rm -f $@
	@$(foreach f,$^,echo include $f >> $@;echo Adding include \"$f\";)

net-tools-config.h: net-tools-config.make
	@echo "Generating \"$@\""
	@$(MKCONFIG) $< > $@

$(MKCONFIG):
	$(MAKE) -C $(dir $@) $(notdir $@)

include $(RGMK)
