RGSRC=../
include $(RGSRC)/envir.mak

# XXX Currently ulibc build from the rg/Makefile. This should be fixed.
#SUBDIRS+=$(if $(CONFIG_ULIBC),ulibc)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_ULIBC),ulibc)
#LINK_DIRS+=$(if $(CONFIG_ULIBC),ulibc)
SUBDIRS+=$(if $(CONFIG_GLIBC),$(if $(GLIBC_IN_TOOLCHAIN),,build/glibc))
SUBDIRS+=$(if $(CONFIG_RG_OPENSSL_COMMON),openssl)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_OPENSSL_COMMON),openssl)
LINK_DIRS+=$(if $(CONFIG_RG_OPENSSL_COMMON),openssl)
SUBDIRS+=$(if $(CONFIG_RG_SYSLOG_COMMON),syslog)
SUBDIRS+=util zlib
SUBDIRS+=$(if $(CONFIG_RG_LANG),language)
SUBDIRS+=$(if $(CONFIG_RG_LICENSE),license)
SUBDIRS+=include
SUBDIRS+=doc
LINK_DIRS+=doc
SUBDIRS+=$(if $(CONFIG_RG_LZMA),lzma)
SUBDIRS+=build
SUBDIRS+=$(if $(CONFIG_RG_TZ),tz)
SUBDIRS+=$(if $(CONFIG_RG_MGT),mgt)
ifeq ($(CONFIG_RG_ONE_MODULE),)
SUBDIRS+=kernel
endif
SUBDIRS+=$(if $(CONFIG_IPTABLES),iptables)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_IPTABLES),iptables)
LINK_DIRS+=$(if $(CONFIG_IPTABLES),iptables)
SUBDIRS+=$(if $(CONFIG_RG_IPROUTE2),iproute2)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_IPROUTE2),iproute2)
LINK_DIRS+=$(if $(CONFIG_RG_IPROUTE2),iproute2)
SUBDIRS+=$(if $(CONFIG_BRIDGE_UTILS),bridge-utils)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_BRIDGE_UTILS),bridge-utils)
SUBDIRS+=$(if $(CONFIG_RG_BZIP2)$(CONFIG_BOOTLDR_UBOOT),boot)
SUBDIRS+=$(if $(CONFIG_RG_BUSYBOX),busybox)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_BUSYBOX),busybox)
LINK_DIRS+=$(if $(CONFIG_RG_BUSYBOX),busybox)
SUBDIRS+=$(if $(CONFIG_CRAMFS_FS_COMMON),$(BUILDDIR)/os/linux/scripts/cramfs)
SUBDIRS+=$(if $(CONFIG_ROMFS_FS),genromfs)
SUBDIRS+=$(if $(CONFIG_RG_TODC),tod)
SUBDIRS+=$(if $(CONFIG_RG_DNS),dns)
SUBDIRS+=$(if $(CONFIG_RG_HTTPS),httpd)
SUBDIRS+=$(if $(CONFIG_RG_WBM)$(CONFIG_RG_SSI),web_mng)
SUBDIRS+=$(if $(CONFIG_RG_LIBIMAGE)$(CONFIG_RG_LIBJPEG),image)
SUBDIRS+=$(if $(CONFIG_RG_KOS),kos)
SUBDIRS+=$(if $(CONFIG_RG_MSS),mss)
SUBDIRS+=$(if $(CONFIG_RG_ELVIS),elvis)
SUBDIRS+=$(if $(CONFIG_RG_CABLEHOME_COMMON),cablehome)
SUBDIRS+=$(if $(CONFIG_RG_KERBEROS),heimdal)
SUBDIRS+=$(if $(CONFIG_RG_UCD_SNMP),ucd-snmp)
SUBDIRS+=$(if $(CONFIG_RG_NETKIT),netkit)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_NETKIT),netkit)
SUBDIRS+=$(if $(CONFIG_RG_NETTOOLS_ARP),net-tools)
JPKG_EXPORTED_DIR_SRC+=$(if $(CONFIG_RG_NETTOOLS_ARP),net-tools)
SUBDIRS+=$(if $(CONFIG_RG_PERM_STORAGE),perm_storage)
SUBDIRS+=$(if $(CONFIG_FLASH),flash)
SUBDIRS+=$(if $(CONFIG_RG_LIBPCAP),libpcap)
SUBDIRS+=$(if $(CONFIG_RG_READLINE),readline)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_LIBPCAP),libpcap)
LINK_DIRS+=$(if $(CONFIG_RG_LIBPCAP),libpcap)
SUBDIRS+=$(if $(CONFIG_RG_TERMCAP),termcap)
SUBDIRS+=$(if $(CONFIG_RG_TCPDUMP),tcpdump)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_TCPDUMP),tcpdump)
LINK_DIRS+=$(if $(CONFIG_RG_TCPDUMP),tcpdump)
SUBDIRS+=$(if $(CONFIG_RG_RMT_UPDATE),rmt-update)
SUBDIRS+=$(if $(CONFIG_RG_WGET),wget)
SUBDIRS+=$(if $(CONFIG_RG_VOIP),voip)
SUBDIRS+=$(if $(CONFIG_GMP),gmp)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_GMP),gmp)
LINK_DIRS+=$(if $(CONFIG_GMP),gmp)
SUBDIRS+=$(if $(CONFIG_IPSEC),ipsec)
SUBDIRS+=$(if $(CONFIG_FREESWAN_COMMON),freeswan)
JPKG_EXPORTED_DIR_SRC+=$(if $(CONFIG_FREESWAN_COMMON),freeswan)
SUBDIRS+=$(if $(CONFIG_RG_X509),x509)
SUBDIRS+=$(if $(CONFIG_PCBOX),lilo)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_PCBOX),lilo)
LINK_DIRS+=$(if $(CONFIG_PCBOX),lilo)
SUBDIRS+=$(if $(CONFIG_ATM),atm)
JPKG_EXPORTED_DIR_SRC+=$(if $(CONFIG_ATM),atm)
SUBDIRS+=$(if $(CONFIG_RG_PPP),ppp)
SUBDIRS+=$(if $(CONFIG_RG_PPPOE_RELAY),pppoe-server)
SUBDIRS+=$(if $(CONFIG_PCMCIA),pcmcia)
SUBDIRS+=$(if $(CONFIG_RG_GDBSERVER),gdb/gdb/gdbserver)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_GDBSERVER),gdb)
SUBDIRS+=$(if $(CONFIG_RG_RIP),rip)
SUBDIRS+=$(if $(CONFIG_RG_IGMP_PROXY),igmp)
SUBDIRS+=$(if $(CONFIG_RG_MCAST_RELAY),igmp)
SUBDIRS+=$(if $(CONFIG_RG_UPNP),upnp)
SUBDIRS+=$(if $(CONFIG_RG_XML),expat)
SUBDIRS+=$(if $(CONFIG_RG_XML),xml)
SUBDIRS+=$(if $(CONFIG_RG_CLI),cli)
SUBDIRS+=$(if $(CONFIG_RG_RMT_MNG),rmt_mng)
SUBDIRS+=$(if $(CONFIG_RG_TELNETS),telnet)
SUBDIRS+=$(if $(CONFIG_RG_BOOTLDR),bootldr)
SUBDIRS+=$(if $(CONFIG_RG_BRIDGE),bridge)
SUBDIRS+=$(if $(CONFIG_RG_USB_SLAVE),usb_slave)
SUBDIRS+=$(if $(CONFIG_VALGRIND),valgrind)
SUBDIRS+=$(if $(CONFIG_RG_FILESERVER),lpd)
SUBDIRS+=$(if $(CONFIG_RG_PRINT_SERVER),print_server)
SUBDIRS+=$(if $(CONFIG_RG_ATTR),attr)
SUBDIRS+=$(if $(CONFIG_RG_ACL),acl)
SUBDIRS+=$(if $(CONFIG_RG_FILESERVER),samba)
JPKG_EXPORTED_DIR_SRC+=$(if $(CONFIG_RG_FILESERVER),samba)
LINK_DIRS+=$(if $(CONFIG_RG_FILESERVER),samba)
SUBDIRS+=$(if $(CONFIG_RG_E2FSPROGS),e2fsprogs)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_E2FSPROGS),e2fsprogs)
LINK_DIRS+=$(if $(CONFIG_RG_E2FSPROGS),e2fsprogs)
SUBDIRS+=$(if $(CONFIG_RG_DOSFSTOOLS),dosfstools)
JPKG_EXPORTED_DIR_SRC+=$(if $(CONFIG_RG_DOSFSTOOLS),dosfstools)
SUBDIRS+=$(if $(CONFIG_RG_UTIL_LINUX),util-linux)
LINK_DIRS+=$(if $(CONFIG_RG_UTIL_LINUX),util-linux)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_UTIL_LINUX),util-linux)
SUBDIRS+=$(if $(CONFIG_RG_RAID),mdadm)
SUBDIRS+=$(if $(CONFIG_RG_DDNS),ddns)
SUBDIRS+=$(if $(CONFIG_RG_MAIL_SERVER),mail)
SUBDIRS+=$(if $(CONFIG_RG_ENTFY),mail_client)
SUBDIRS+=$(if $(CONFIG_RG_8021X),802.1x)
SUBDIRS+=$(if $(CONFIG_RG_WPA),wpa)
SUBDIRS+=$(if $(CONFIG_RG_RADIUS),radius)
SUBDIRS+=$(if $(CONFIG_HOTPLUG),hotplug)
SUBDIRS+=$(if $(CONFIG_RG_FLEX),flex)
SUBDIRS+=$(if $(CONFIG_RG_USAGI),usagi)
SUBDIRS+=$(if $(CONFIG_RG_L2TPC),l2tp)
SUBDIRS+=$(if $(CONFIG_RG_VLAN_8021Q),vlan)
SUBDIRS+=$(if $(CONFIG_RG_TFTP_SERVER),tftps)
SUBDIRS+=$(if $(CONFIG_ZC_AUTO_CONFIG_NON_PNP),auto_conf)
SUBDIRS+=$(if $(CONFIG_RG_OS_VXWORKS),route)
SUBDIRS+=$(if $(CONFIG_RG_RTP),rtp)
SUBDIRS+=$(if $(CONFIG_RG_FTP_SERVER),ftp)
SUBDIRS+=$(if $(CONFIG_RG_WEB_SERVER),web_server)
SUBDIRS+=$(if $(CONFIG_RG_STAR),star)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_STAR),star)
SUBDIRS+=$(if $(CONFIG_RG_BACKUP),backup)
SUBDIRS+=$(if $(CONFIG_RG_SAMPLES_COMMON),samples)
JPKG_EXPORTED_DIR_SRC+=samples
SUBDIRS+=$(if $(CONFIG_RG_FIREWALL)$(CONFIG_RG_NAT)$(CONFIG_RG_RNAT),firewall)
SUBDIRS+=vendor
SUBDIRS+=$(if $(CONFIG_RG_RGLOADER_COMMON),rgloader)
SUBDIRS+=$(if $(CONFIG_RG_TEST_TOOLS),test_tools)
SUBDIRS+=$(if $(CONFIG_RG_DHCP_COMMON),dhcp)
SUBDIRS+=$(if $(CONFIG_RG_XML2),libxml)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_XML2),libxml)
SUBDIRS+=$(if $(CONFIG_RG_XMLSEC),xmlsec)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_RG_XMLSEC),xmlsec)
SUBDIRS+=$(if $(CONFIG_RG_DSLHOME),dslhome)
SUBDIRS+=$(if $(CONFIG_RG_QOS),qos)
SUBDIRS+=$(if $(CONFIG_RG_JPKG),tools)
SUBDIRS+=$(if $(CONFIG_RG_WEBCAM),webcam)
SUBDIRS+=$(if $(CONFIG_WIRELESS_TOOLS),wireless_tools)
JPKG_EXPORTED_DIR+=$(if $(CONFIG_WIRELESS_TOOLS),wireless_tools)
SUBDIRS+=$(if $(CONFIG_RG_FASTPATH_IPTV),fastpath)
# main _must_ compile after all libraries and tasks.
SUBDIRS+=main

# autotest is not part of openrg, but it depends on rg_default.c
# from main therefor it _must_ compile after main.
SUBDIRS+=$(if $(CONFIG_RG_AUTOTEST),autotest)

# tools are currently relevant for UML only
SUBDIRS+=$(if $(CONFIG_RG_JPKG_UML)$(CONFIG_RG_JPKG_SRC),tools)

ifneq ($(CONFIG_RG_ONE_MODULE),)
SUBDIRS+=kernel
endif

# Build must be the last subdir in order for make ramdisk to work
# XXX We add ulibc because it is built from rg/Makefile. This shouldbe fixed
RAMDISK_SUBDIRS:=$(if $(CONFIG_ULIBC),ulibc) $(filter-out build,$(SUBDIRS)) build

include $(RGMK)

